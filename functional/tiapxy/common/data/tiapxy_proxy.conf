# -------------------------------------------------------------------------------------------------
# Core ProxyPass and ProxyReversePass
# -------------------------------------------------------------------------------------------------

<VirtualHost *:%APACHE_PORT%>

   ServerName       vh1.com
   
   SSLEngine On
   SSLProtocol ALL
   SSLWallet %FUNCTIONAL_BASE_DIR%/common/data/wallets/OHSCore
   SSLCipherSuite ALL

   SSLProxyEngine On
   SSLProxyProtocol ALL
   SSLProxyWallet %FUNCTIONAL_BASE_DIR%/common/data/wallets/OHSCore
   SSLProxyCipherSuite ALL    
   
   # HTTP - HTTP
   ProxyPass        "/hh" "http://%ADMIN_HOST%:%MS1_HTTP_PORT%"
   ProxyPassReverse "/hh" "http://%ADMIN_HOST%:%MS1_HTTP_PORT%"
   
   # HTTP - SSL
   ProxyPass        "/hs" "https://%ADMIN_HOST%:%MS1_HTTPS_PORT%"
   ProxyPassReverse "/hs" "https://%ADMIN_HOST%:%MS1_HTTPS_PORT%"
   
</VirtualHost>

<VirtualHost *:%APACHE_SSL_PORT%>

   ServerName       vh2.com

   SSLEngine On
   SSLProtocol ALL
   SSLWallet %FUNCTIONAL_BASE_DIR%/common/data/wallets/OHSCore
   SSLCipherSuite ALL

   SSLProxyEngine On
   SSLProxyProtocol ALL
   SSLProxyWallet %FUNCTIONAL_BASE_DIR%/common/data/wallets/OHSCore
   SSLProxyCipherSuite ALL

   # SSL - SSL
   ProxyPass        "/ss" "https://%ADMIN_HOST%:%MS1_HTTPS_PORT%"
   ProxyPassReverse "/ss" "https://%ADMIN_HOST%:%MS1_HTTPS_PORT%"

   # SSL - HTTP (SSL Termination)
   ProxyPass        "/sh" "http://%ADMIN_HOST%:%MS1_HTTP_PORT%"
   ProxyPassReverse "/sh" "http://%ADMIN_HOST%:%MS1_HTTP_PORT%"

</VirtualHost>

# -------------------------------------------------------------------------------------------------
# Multiple proxy : HTTP frontend 
# -------------------------------------------------------------------------------------------------

<VirtualHost *:%APACHE_PORT%>

   ServerName       vh3.com

   SSLEngine On
   SSLProtocol ALL
   SSLWallet %FUNCTIONAL_BASE_DIR%/common/data/wallets/OHSCore
   SSLCipherSuite ALL

   SSLProxyEngine On
   SSLProxyProtocol ALL
   SSLProxyWallet %FUNCTIONAL_BASE_DIR%/common/data/wallets/OHSCore
   SSLProxyCipherSuite ALL

   # Proxy : HTTP - HTTP
   <Proxy "balancer://vh3-hh">
      ProxySet lbmethod=byrequests
      BalancerMember http://%ADMIN_HOST%:%MS1_HTTP_PORT%
      BalancerMember http://%ADMIN_HOST%:%MS2_HTTP_PORT%
   </Proxy>
   
   # Proxy : HTTP - SSL
   <Proxy "balancer://vh3-hs">
      ProxySet lbmethod=byrequests
      BalancerMember https://%ADMIN_HOST%:%MS1_HTTPS_PORT%
      BalancerMember https://%ADMIN_HOST%:%MS2_HTTPS_PORT%
   </Proxy>   

   # Proxy pass : HTTP - HTTP
   ProxyPass        "/vh3-hh"   "balancer://vh3-hh"
   ProxyPassReverse "/vh3-hh"   "balancer://vh3-hh"
   
   # Proxy pass : HTTP - SSL
   ProxyPass        "/vh3-hs"   "balancer://vh3-hs"
   ProxyPassReverse "/vh3-hs"   "balancer://vh3-hs"   
   
</VirtualHost>

# -------------------------------------------------------------------------------------------------
# Multiple proxy : SSL frontend 
# -------------------------------------------------------------------------------------------------

<VirtualHost *:%APACHE_SSL_PORT%>

   ServerName       vh4.com

   SSLEngine On
   SSLProtocol ALL
   SSLWallet %FUNCTIONAL_BASE_DIR%/common/data/wallets/OHSCore
   SSLCipherSuite ALL

   SSLProxyEngine On
   SSLProxyProtocol ALL
   SSLProxyWallet %FUNCTIONAL_BASE_DIR%/common/data/wallets/OHSCore
   SSLProxyCipherSuite ALL

   # Proxy : SSL - SSL
   <Proxy "balancer://vh4-ss">
      ProxySet lbmethod=byrequests
      BalancerMember https://%ADMIN_HOST%:%MS1_HTTPS_PORT%
      BalancerMember https://%ADMIN_HOST%:%MS2_HTTPS_PORT%
   </Proxy>
   
   # Proxy : SSL - HTTP
   <Proxy "balancer://vh4-sh">
      ProxySet lbmethod=byrequests
      BalancerMember http://%ADMIN_HOST%:%MS1_HTTP_PORT%
      BalancerMember http://%ADMIN_HOST%:%MS2_HTTP_PORT%
   </Proxy>   

   # Proxy : SSL - SSL
   ProxyPass        "/vh4-ss"   "balancer://vh4-ss"
   ProxyPassReverse "/vh4-ss"   "balancer://vh4-ss"

   # Proxy : SSL - HTTP
   ProxyPass        "/vh4-sh"   "balancer://vh4-sh"
   ProxyPassReverse "/vh4-sh"   "balancer://vh4-sh"
   
</VirtualHost>

# -------------------------------------------------------------------------------------------------
# Multiple proxy : SSLProxy directive - present at VH, absent at proxy
# -------------------------------------------------------------------------------------------------

<VirtualHost *:%APACHE_SSL_PORT%>

   ServerName       vh5.com

   SSLEngine On
   SSLProtocol ALL
   SSLWallet %FUNCTIONAL_BASE_DIR%/common/data/wallets/OHSCore
   SSLCipherSuite ALL

   SSLProxyEngine On
   SSLProxyProtocol ALL
   SSLProxyWallet %FUNCTIONAL_BASE_DIR%/common/data/wallets/OHSCore
   SSLProxyCipherSuite ALL
   
   # Proxy : SSL - HTTP
   <Proxy "balancer://vh5-sh-p1">
      ProxySet lbmethod=byrequests
      BalancerMember http://%ADMIN_HOST%:%MS1_HTTP_PORT%
   </Proxy>

   # Proxy : SSL - HTTP
   <Proxy "balancer://vh5-sh-p2">
      ProxySet lbmethod=byrequests
      BalancerMember http://%ADMIN_HOST%:%MS2_HTTP_PORT%
   </Proxy>
   
   # Proxy : SSL - SSL
   <Proxy "balancer://vh5-ss-p1">
      ProxySet lbmethod=byrequests
      BalancerMember https://%ADMIN_HOST%:%MS1_HTTPS_PORT%
   </Proxy>
   
   # Proxy : SSL - SSL
   <Proxy "balancer://vh5-ss-p2">
      ProxySet lbmethod=byrequests
      BalancerMember https://%ADMIN_HOST%:%MS2_HTTPS_PORT%
   </Proxy>

   # Proxy pass : SSL - HTTP
   ProxyPass        "/vh5-sh-p1"   "balancer://vh5-sh-p1"
   ProxyPassReverse "/vh5-sh-p1"   "balancer://vh5-sh-p1"
   
   # Proxy pass : SSL - HTTP
   ProxyPass        "/vh5-sh-p2"   "balancer://vh5-sh-p2"
   ProxyPassReverse "/vh5-sh-p2"   "balancer://vh5-sh-p2"   
   
   # Proxy pass : SSL - SSL
   ProxyPass        "/vh5-ss-p1"   "balancer://vh5-ss-p1"
   ProxyPassReverse "/vh5-ss-p1"   "balancer://vh5-ss-p1"
   
   # Proxy pass : SSL - SSL
   ProxyPass        "/vh5-ss-p2"   "balancer://vh5-ss-p2"
   ProxyPassReverse "/vh5-ss-p2"   "balancer://vh5-ss-p2"   
   
</VirtualHost>

# -------------------------------------------------------------------------------------------------
# Multiple proxy : SSLProxy directive - absent at VH, present at proxy
# -------------------------------------------------------------------------------------------------

<VirtualHost *:%APACHE_SSL_PORT%>

   ServerName       vh6.com

   SSLEngine On
   SSLProtocol ALL
   SSLWallet %FUNCTIONAL_BASE_DIR%/common/data/wallets/OHSCore
   SSLCipherSuite ALL
   
   # Proxy : SSL - HTTP
   <Proxy "balancer://vh6-sh">
      ProxySet lbmethod=byrequests   
      BalancerMember http://%ADMIN_HOST%:%MS1_HTTP_PORT%
   </Proxy>     
   
   # Proxy : SSL - SSL
   <Proxy "balancer://vh6-ss-p1">
      ProxySet lbmethod=byrequests
   
      SSLProxyEngine On
      SSLProxyWallet %FUNCTIONAL_BASE_DIR%/common/data/wallets/OHSCore
      SSLProxyProtocol TLSv1.2
      SSLProxyCipherSuite SHA384   
   
      BalancerMember https://%ADMIN_HOST%:%MS1_HTTPS_PORT%
   </Proxy>    
   
   # Proxy : SSL - SSL
   <Proxy "balancer://vh6-ss-p2">
      ProxySet lbmethod=byrequests
   
      SSLProxyEngine On
      SSLProxyWallet %FUNCTIONAL_BASE_DIR%/common/data/wallets/OHSCore
      SSLProxyProtocol TLSv1.1
      SSLProxyCipherSuite SHA256   
   
      BalancerMember https://%ADMIN_HOST%:%MS2_HTTPS_PORT%
   </Proxy>     
   
   # Proxy pass : SSL - HTTP
   ProxyPass        "/vh6-sh"      "balancer://vh6-sh"
   ProxyPassReverse "/vh6-sh"      "balancer://vh6-sh"   

   # Proxy pass : SSL - SSL
   ProxyPass        "/vh6-ss-p1"   "balancer://vh6-ss-p1"
   ProxyPassReverse "/vh6-ss-p1"   "balancer://vh6-ss-p1"   

   # Proxy pass : SSL - SSL
   ProxyPass        "/vh6-ss-p2"   "balancer://vh6-ss-p2"
   ProxyPassReverse "/vh6-ss-p2"   "balancer://vh6-ss-p2"   
   
</VirtualHost>

# -------------------------------------------------------------------------------------------------
# Multiple proxy : SSLProxy directive - present at VH, present for few proxy, absent for few other 
#   - Directives at VH are inherited by proxy      (if absent)
#   - Directives at proxy override the ones at VH  (if present)   
# -------------------------------------------------------------------------------------------------


<VirtualHost *:%APACHE_SSL_PORT%>

   ServerName       vh7.com

   SSLEngine On
   SSLProtocol ALL
   SSLWallet %FUNCTIONAL_BASE_DIR%/common/data/wallets/OHSCore
   SSLCipherSuite ALL

   SSLProxyEngine On
   SSLProxyWallet %FUNCTIONAL_BASE_DIR%/common/data/wallets/OHSCore
   SSLProxyProtocol TLSv1.2
   SSLProxyCipherSuite SHA384   
   
   # Proxy : SSL - HTTP 
   <Proxy "balancer://vh7-sh">
      ProxySet lbmethod=byrequests
      BalancerMember http://%ADMIN_HOST%:%MS1_HTTP_PORT%
   </Proxy>    

   # Proxy : SSL - SSL
   <Proxy "balancer://vh7-ss-p1">
      ProxySet lbmethod=byrequests
      BalancerMember https://%ADMIN_HOST%:%MS1_HTTPS_PORT%
   </Proxy>    
   
   # Proxy : SSL - SSL
   <Proxy "balancer://vh7-ss-p2">
      ProxySet lbmethod=byrequests
   
      SSLProxyEngine On
      SSLProxyWallet %FUNCTIONAL_BASE_DIR%/common/data/wallets/OHSCore
      SSLProxyProtocol TLSv1.1
      SSLProxyCipherSuite SHA256   
   
      BalancerMember https://%ADMIN_HOST%:%MS2_HTTPS_PORT%
   </Proxy> 
   
   # Proxy pass : SSL - HTTP 
   ProxyPass        "/vh7-sh"     "balancer://vh7-sh"
   ProxyPassReverse "/vh7-sh"     "balancer://vh7-sh"   

   # Proxy pass : SSL - SSL
   ProxyPass        "/vh7-ss-p1"  "balancer://vh7-ss-p1"
   ProxyPassReverse "/vh7-ss-p1"  "balancer://vh7-ss-p1"   

   # Proxy pass : SSL - SSL
   ProxyPass        "/vh7-ss-p2"  "balancer://vh7-ss-p2"
   ProxyPassReverse "/vh7-ss-p2"  "balancer://vh7-ss-p2"
   
</VirtualHost>
